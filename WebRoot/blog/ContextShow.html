<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    <meta http-equiv="expires" content="0">
    <title>博客</title>
    <link rel="stylesheet" type="text/css" href="/resource/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/resource/css/prism.css">
    <link rel="stylesheet" type="text/css" href="/resource/css/baseCss.css">
    <style>
        .coverImg {
            width: 100%;
            /* min-height: 90px; */
            max-height: 540px;
            object-fit: contain;
        }

        #contextMain img {
            object-fit: contain;
            max-width: 100%;
            width: auto;
            height: auto;
            display: block;
            margin: 0 auto;
        }



        pre[class*="language-"].line-numbers {
            position: relative;
            padding-left: 3.8em;
            counter-reset: linenumber;
        }

        pre[class*="language-"].line-numbers>code {
            position: relative;
            white-space: inherit;
        }

        .line-numbers .line-numbers-rows {
            position: absolute;
            pointer-events: none;
            top: 0;
            font-size: 100%;
            left: -3.8em;
            width: 3em;
            /* works for line-numbers below 1000 lines */
            letter-spacing: -1px;
            border-right: 1px solid #999;

            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;

        }

        .line-numbers-rows>span {
            display: block;
            counter-increment: linenumber;
        }

        .line-numbers-rows>span:before {
            content: counter(linenumber);
            color: #999;
            display: block;
            padding-right: 0.8em;
            text-align: right;
        }
    </style>
    <script src="/resource/js/jquery-3.6.0.min.js"></script>
    <script src="/resource/js/bootstrap.min.js"></script>
    <script src="/resource/js/baseFunction.js"></script>
    <script>
        function init() {

            if (!docCookies.hasItem("VisitId")) {
                docCookies.setItem("VisitId", getUuid());
            }

            loadContext();
        }

        var createTime;
        var updateTime;
        function loadContext() {
            var params = new URLSearchParams(location.search);
            var uuid = params.get("id");
            if (uuid == null || uuid == "undefined" || uuid.trim() == "") {
                commonUtil.message('该文章不存在! ', 'danger', 2000);
                setTimeout(function () { window.location = "Context.html"; }, 3000);
                return;
            }
            var context = ajax("get", "blog/context/contextRead?contextId=" + uuid, false);
            if (context == null) {
                commonUtil.message('文章载入异常! ', 'danger', 2000);
                setTimeout(function () { window.location = "Context.html"; }, 3000);
                return;
            }
            document.getElementById('coverImg').innerHTML = '<img class="coverImg" src="' + getAddress() + context.cover_img_location + '" loading="lazy">';
            document.getElementById('contextTitle').innerText = context.title;
            document.title = context.title;

            var showContext = context.context;
            if (!showContext.includes("<") && !showContext.includes(">")) {
                showContext = Base64.decode(showContext);   // Base64解密
            }
            document.getElementById('contextMain').innerHTML = showContext;
            document.getElementById('contextAuthor').innerText = context.user;
            createTime = context.create_time;
            updateTime = context.update_time;
            document.getElementById('contextTime').innerText = updateTime;
            document.getElementById('contextAmount').innerText = context.amount;


            // $('pre').addClass('line-numbers');

            // 延迟加载prism显示代码的脚本
            prismDelayLoad();
        }

        function changeTime() {
            var value = document.getElementById('contextTime').innerText;
            if (value.includes("更新")) {
                document.getElementById('contextTime').innerText = createTime;
            } else {
                document.getElementById('contextTime').innerText = updateTime;
            }
        }

        function prismDelayLoad() {
            var script = document.createElement('script');
            script.src = "/resource/js/prism.js";
            document.body.appendChild(script);

            var style = document.createElement('style');
            style.innerHTML = "";
            document.body.appendChild(style);

            var pre = $('pre');
            pre.addClass('line-numbers');



            (function () {

                if (typeof Prism === 'undefined' || typeof document === 'undefined') {
                    return;
                }

                /**
                 * Plugin name which is used as a class name for <pre> which is activating the plugin
                 *
                 * @type {string}
                 */
                var PLUGIN_NAME = 'line-numbers';

                /**
                 * Regular expression used for determining line breaks
                 *
                 * @type {RegExp}
                 */
                var NEW_LINE_EXP = /\n(?!$)/g;


                /**
                 * Global exports
                 */
                var config = Prism.plugins.lineNumbers = {
                    /**
                     * Get node for provided line number
                     *
                     * @param {Element} element pre element
                     * @param {number} number line number
                     * @returns {Element|undefined}
                     */
                    getLine: function (element, number) {
                        if (element.tagName !== 'PRE' || !element.classList.contains(PLUGIN_NAME)) {
                            return;
                        }

                        var lineNumberRows = element.querySelector('.line-numbers-rows');
                        if (!lineNumberRows) {
                            return;
                        }
                        var lineNumberStart = parseInt(element.getAttribute('data-start'), 10) || 1;
                        var lineNumberEnd = lineNumberStart + (lineNumberRows.children.length - 1);

                        if (number < lineNumberStart) {
                            number = lineNumberStart;
                        }
                        if (number > lineNumberEnd) {
                            number = lineNumberEnd;
                        }

                        var lineIndex = number - lineNumberStart;

                        return lineNumberRows.children[lineIndex];
                    },

                    /**
                     * Resizes the line numbers of the given element.
                     *
                     * This function will not add line numbers. It will only resize existing ones.
                     *
                     * @param {HTMLElement} element A `<pre>` element with line numbers.
                     * @returns {void}
                     */
                    resize: function (element) {
                        resizeElements([element]);
                    },

                    /**
                     * Whether the plugin can assume that the units font sizes and margins are not depended on the size of
                     * the current viewport.
                     *
                     * Setting this to `true` will allow the plugin to do certain optimizations for better performance.
                     *
                     * Set this to `false` if you use any of the following CSS units: `vh`, `vw`, `vmin`, `vmax`.
                     *
                     * @type {boolean}
                     */
                    assumeViewportIndependence: true
                };

                /**
                 * Resizes the given elements.
                 *
                 * @param {HTMLElement[]} elements
                 */
                function resizeElements(elements) {
                    elements = elements.filter(function (e) {
                        var codeStyles = getStyles(e);
                        var whiteSpace = codeStyles['white-space'];
                        return whiteSpace === 'pre-wrap' || whiteSpace === 'pre-line';
                    });

                    if (elements.length == 0) {
                        return;
                    }

                    var infos = elements.map(function (element) {
                        var codeElement = element.querySelector('code');
                        var lineNumbersWrapper = element.querySelector('.line-numbers-rows');
                        if (!codeElement || !lineNumbersWrapper) {
                            return undefined;
                        }

                        /** @type {HTMLElement} */
                        var lineNumberSizer = element.querySelector('.line-numbers-sizer');
                        var codeLines = codeElement.textContent.split(NEW_LINE_EXP);

                        if (!lineNumberSizer) {
                            lineNumberSizer = document.createElement('span');
                            lineNumberSizer.className = 'line-numbers-sizer';

                            codeElement.appendChild(lineNumberSizer);
                        }

                        lineNumberSizer.innerHTML = '0';
                        lineNumberSizer.style.display = 'block';

                        var oneLinerHeight = lineNumberSizer.getBoundingClientRect().height;
                        lineNumberSizer.innerHTML = '';

                        return {
                            element: element,
                            lines: codeLines,
                            lineHeights: [],
                            oneLinerHeight: oneLinerHeight,
                            sizer: lineNumberSizer,
                        };
                    }).filter(Boolean);

                    infos.forEach(function (info) {
                        var lineNumberSizer = info.sizer;
                        var lines = info.lines;
                        var lineHeights = info.lineHeights;
                        var oneLinerHeight = info.oneLinerHeight;

                        lineHeights[lines.length - 1] = undefined;
                        lines.forEach(function (line, index) {
                            if (line && line.length > 1) {
                                var e = lineNumberSizer.appendChild(document.createElement('span'));
                                e.style.display = 'block';
                                e.textContent = line;
                            } else {
                                lineHeights[index] = oneLinerHeight;
                            }
                        });
                    });

                    infos.forEach(function (info) {
                        var lineNumberSizer = info.sizer;
                        var lineHeights = info.lineHeights;

                        var childIndex = 0;
                        for (var i = 0; i < lineHeights.length; i++) {
                            if (lineHeights[i] === undefined) {
                                lineHeights[i] = lineNumberSizer.children[childIndex++].getBoundingClientRect().height;
                            }
                        }
                    });

                    infos.forEach(function (info) {
                        var lineNumberSizer = info.sizer;
                        var wrapper = info.element.querySelector('.line-numbers-rows');

                        lineNumberSizer.style.display = 'none';
                        lineNumberSizer.innerHTML = '';

                        info.lineHeights.forEach(function (height, lineNumber) {
                            wrapper.children[lineNumber].style.height = height + 'px';
                        });
                    });
                }

                /**
                 * Returns style declarations for the element
                 *
                 * @param {Element} element
                 */
                function getStyles(element) {
                    if (!element) {
                        return null;
                    }

                    return window.getComputedStyle ? getComputedStyle(element) : (element.currentStyle || null);
                }

                var lastWidth = undefined;
                window.addEventListener('resize', function () {
                    if (config.assumeViewportIndependence && lastWidth === window.innerWidth) {
                        return;
                    }
                    lastWidth = window.innerWidth;

                    resizeElements(Array.prototype.slice.call(document.querySelectorAll('pre.' + PLUGIN_NAME)));
                });

                Prism.hooks.add('complete', function (env) {
                    if (!env.code) {
                        return;
                    }

                    var code = /** @type {Element} */ (env.element);
                    var pre = /** @type {HTMLElement} */ (code.parentNode);

                    // works only for <code> wrapped inside <pre> (not inline)
                    if (!pre || !/pre/i.test(pre.nodeName)) {
                        return;
                    }

                    // Abort if line numbers already exists
                    if (code.querySelector('.line-numbers-rows')) {
                        return;
                    }

                    // only add line numbers if <code> or one of its ancestors has the `line-numbers` class
                    if (!Prism.util.isActive(code, PLUGIN_NAME)) {
                        return;
                    }

                    // Remove the class 'line-numbers' from the <code>
                    code.classList.remove(PLUGIN_NAME);
                    // Add the class 'line-numbers' to the <pre>
                    pre.classList.add(PLUGIN_NAME);

                    var match = env.code.match(NEW_LINE_EXP);
                    var linesNum = match ? match.length + 1 : 1;
                    var lineNumbersWrapper;

                    var lines = new Array(linesNum + 1).join('<span></span>');

                    lineNumbersWrapper = document.createElement('span');
                    lineNumbersWrapper.setAttribute('aria-hidden', 'true');
                    lineNumbersWrapper.className = 'line-numbers-rows';
                    lineNumbersWrapper.innerHTML = lines;

                    if (pre.hasAttribute('data-start')) {
                        pre.style.counterReset = 'linenumber ' + (parseInt(pre.getAttribute('data-start'), 10) - 1);
                    }

                    env.element.appendChild(lineNumbersWrapper);

                    resizeElements([pre]);

                    Prism.hooks.run('line-numbers', env);
                });

                Prism.hooks.add('line-numbers', function (env) {
                    env.plugins = env.plugins || {};
                    env.plugins.lineNumbers = true;
                });

            }());
        }
    </script>
</head>

<body onload="init()">
    <div id="divHeader">
        <script>
            $('#divHeader').load('../resource/header.html');
            var activeHeader = "blog";
        </script>
    </div>

    <div id="divBody">
        <div class="panel panel-default">
            <div id="coverImg"></div>
            <div class="page-header" style="text-align: center;">
                <h1 id="contextTitle">鸡你太美</h1>
                <small>
                    <span class="glyphicon glyphicon-user" aria-hidden="true"></span> <span
                        id="contextAuthor">超级无敌大佬王</span>&nbsp;&nbsp;
                    <span class="glyphicon glyphicon-time" aria-hidden="true"></span> <span id="contextTime"
                        onclick="changeTime()">1970-01-01 00:00:00</span>&nbsp;&nbsp;
                    <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> <span
                        id="contextAmount">-1</span>
                </small>
            </div>
            <div id="contextMain" class="panel-body">
                练习时长两年半
            </div>
        </div>
    </div>

    <div id="divFooter">
        <script>
            $('#divFooter').load('../resource/footer.html');
        </script>
    </div>
</body>

</html>