<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ContextList</title>
    <link rel="stylesheet" type="text/css" href="/resource/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/resource/css/baseCss.css">
    <style>
        .modal-data {
            max-width: 600px;
            width: 80%;
            margin: 200px auto;
            background-color: #fff;
            border: 2px solid #000;
            border-radius: 5px;
            padding: 15px;
        }

        .media-object {
            width: 100px;
            height: 100px;
            object-fit: cover;
        }

        .item {
            text-align: center;
            /* position: relative; */
        }

        .imgSlide {
            width: 100%;
            max-height: 540px;
            min-height: 540px;
            /* display: inline-block;
            vertical-align: middle; */
            object-fit: cover;
        }

        .pointerCursor {
            cursor: pointer;
        }
    </style>
    <script src="/resource/js/jquery-3.6.0.min.js"></script>
    <script src="/resource/js/bootstrap.min.js"></script>
    <script src="/resource/js/baseFunction.js"></script>
    <script src="/resource/js/cookieUtils.js"></script>
    <script>
        function init() {
            showRecommendContext();
            showContextList();
            // pageAction("init");
        }

        function showRecommendContext() {
            var contextRecommend = ajax("get", "blog/context/getContextRecommend", false);
            for (let i = 0; i < contextRecommend.length; i++) {
                let context = contextRecommend[i];
                let active = "";
                if (i == 0) {
                    active = "active";
                }
                let innerHTML = '<div class="item ' + active + '">'
                    + '<img class="imgSlide" src="' + getAddress() + context.cover_img_location + '" loading="lazy">'
                    + '<div class="container">'
                    + '<div class="carousel-caption" onclick="contextShow(\'' + context.uuid + '\')">'
                    + '<h1 class="pointerCursor">' + context.title + '</h1>'
                    + '<p class="pointerCursor">' + context.brief + '</p>'
                    // +        '<p><a class="btn btn-lg btn-primary" href="javascript:contextShow(\'' + context.uuid + '\')" role="button">查看详情</a></p>'
                    + '</div></div></div>';
                document.getElementById('contextRecommend').innerHTML += innerHTML;
            }
        }

        var pageSize = 10;  // 当前条数
        var pageTotal;      // 总条数
        var pageNum = 1;    // 当前页数
        var pagePages;      // 总页数
        function showContextList() {
            var pages = "pageNum=" + pageNum + "&pageSize=" + pageSize;
            var controller = "blog/context/getContextList?" + pages;
            var contextList = ajax("get", controller, false);

            // pageSize = contextList[0].pageSize;     // 当前条数
            pageTotal = contextList[0].pageTotal;   // 总条数
            pageNum = contextList[0].pageNum;       // 当前页数
            pagePages = contextList[0].pagePages;   // 总页数
            pageRefresh();
            $('#contextList').empty();
            for (let i = 1; i < contextList.length; i++) {
                let context = contextList[i];
                document.getElementById('contextList').innerHTML += '<div class="media" onclick="contextShow(\'' + context.uuid + '\')"><div class="media-left"><a><img class="media-object" src="' + getAddress() + context.cover_img_location + '" alt="' + context.title + '"></a></div><div class="media-body"><h4 class="media-heading">' + context.title + '</h4>' + context.brief + '<br><span class="glyphicon glyphicon-user" aria-hidden="true"></span> ' + context.user + '&nbsp;&nbsp;<span class="glyphicon glyphicon-time" aria-hidden="true"></span> ' + context.update_time + '</div></div>';
                document.getElementById('contextList').innerHTML += '<br>';
            }
        }

        function pageRefresh() {
            // document.getElementById("pagePrevious").className += "disabled";
            // document.getElementById("pageNext").className += "disabled";

            // $("#pagePrevious").addClass("disable")
            // $("#pageNext").addClass("disable")
            if (pagePages == 1) {
                document.getElementById("pagePrevious").classList.add("disabled");
                document.getElementById("pageNext").classList.add("disabled");
            } else if (pageNum == 1) {
                document.getElementById("pagePrevious").classList.add("disabled");
            } else if (pageNum == pagePages) {
                document.getElementById("pageNext").classList.add("disabled");
            } else {
                document.getElementById("pagePrevious").classList.remove("disabled");
                document.getElementById("pageNext").classList.remove("disabled");
            }
            // window.location.reload("#pagePrevious");
            // window.location.reload("#pageNext");
        }

        function pageAction(action) {
            if (action.includes("p")) {
                if (pageNum > 1) {
                    document.getElementById("pagePrevious").classList.remove("disabled");
                    pageNum--;
                }
            } else if (action.includes("n")) {
                if (pageNum < pagePages) {
                    document.getElementById("pageNext").classList.remove("disabled");
                    pageNum++;
                }
            }
            // window.location.reload("#pagePrevious");
            // window.location.reload("#pageNext");
            showContextList();
            
        }

        function contextShow(uuid) {
            // window.location.href = "ContextShow.html?id=" + uuid;
            window.open("ContextShow.html?id=" + uuid);
        }


    </script>
</head>

<body onload="init()">
    <div id="divHeader">
        <script>
            $('#divHeader').load('../resource/header.html');
            var activeHeader = "blog";
        </script>
    </div>

    <!-- 列表 -->
    <div id="divBody">

        <div id="myCarousel" class="carousel slide" data-ride="carousel">
            <!-- Indicators -->
            <ol class="carousel-indicators">
                <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                <li data-target="#myCarousel" data-slide-to="1" class=""></li>
                <li data-target="#myCarousel" data-slide-to="2" class=""></li>
            </ol>
            <div id="contextRecommend" class="contextSlide carousel-inner" role="listbox">
            </div>
            <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
                <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
                <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>

        <div class="panel panel-default">
            <div id="contextSearch">

            </div>
            <div class="panel-heading">
                <h3 class="panel-title">文章列表</h3>
            </div>
            <div id="contextList" class="panel-body">
            </div>
            <div style="text-align: center;">

                <nav aria-label="Page navigation">
                    <ul class="pagination">
                        <li id="pagePrevious" class="previous"><a href="javascript:pageAction('previous');">&laquo;&nbsp;上一页</a></li>
                        <li id="pageNext" class="next"><a href="javascript:pageAction('next');">下一页&nbsp;&raquo;</a>
                        </li>
                    </ul>
                </nav>
            </div>

        </div>
    </div>

    <div id="divFooter">
        <script>
            $('#divFooter').load('../resource/footer.html');
        </script>
    </div>
</body>

</html>